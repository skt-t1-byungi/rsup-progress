{"version":3,"sources":["../src/index.ts","app.ts"],"names":[],"mappings":"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","file":"app.dc15175c.js","sourceRoot":"..\\website","sourcesContent":["interface Options {\r\n    maxWidth?: number | string\r\n    height?: number | string\r\n    duration?: number\r\n    hideDuration?: number\r\n    zIndex?: number | string\r\n    className?: string\r\n    color?: string\r\n    timing?: string\r\n    position?: 'top' | 'bottom' | 'none'\r\n    container?: HTMLElement\r\n}\r\n\r\nconst enum STATE {\r\n    DISAPPEAR = -1,\r\n    NOTHING,\r\n    APPEAR,\r\n    PENDING,\r\n    DISAPPEAR_RESTART,\r\n}\r\n\r\nconst PERSIST_TIME = 150\r\n\r\nexport default class Progress {\r\n    private _el = document.createElement('div')\r\n    private _state = STATE.NOTHING\r\n    private _opts = {\r\n        maxWidth: '99.8%',\r\n        height: '4px',\r\n        duration: 60000,\r\n        hideDuration: 400,\r\n        zIndex: '9999',\r\n        color: '#ff1a59',\r\n        className: '',\r\n        timing: 'cubic-bezier(0,1,0,1)',\r\n        position: 'top',\r\n        container: document.body,\r\n    }\r\n    private _rafId: number | null = null\r\n    private _timerId: ReturnType<typeof setTimeout> | null = null\r\n    private _promises: Promise<any>[] = []\r\n    private _delayTimers: ReturnType<typeof setTimeout>[] = []\r\n\r\n    constructor(opts: Options = {}) {\r\n        this.setOptions(opts)\r\n    }\r\n\r\n    setOptions(opts: Options) {\r\n        if (isNumber(opts.maxWidth)) opts.maxWidth = opts.maxWidth + 'px'\r\n        if (isNumber(opts.height)) opts.height = opts.height + 'px'\r\n        if (isNumber(opts.zIndex)) opts.zIndex = String(opts.zIndex)\r\n\r\n        const options = assign(this._opts, opts)\r\n        this._el.className = options.className\r\n\r\n        const style = {\r\n            height: options.height,\r\n            background: options.color,\r\n            zIndex: options.zIndex,\r\n            position: '',\r\n            left: '',\r\n            top: '',\r\n            bottom: '',\r\n        }\r\n        switch (options.position) {\r\n            case 'top':\r\n                style.position = 'fixed'\r\n                style.top = '0'\r\n                break\r\n            case 'bottom':\r\n                style.position = 'fixed'\r\n                style.bottom = '0'\r\n                break\r\n        }\r\n        this._css(style)\r\n    }\r\n\r\n    private _css(style: Partial<CSSStyleDeclaration>) {\r\n        assign(this._el.style, style)\r\n    }\r\n\r\n    get isInProgress() {\r\n        return this._state > 0\r\n    }\r\n\r\n    start() {\r\n        switch (this._state) {\r\n            case STATE.APPEAR:\r\n            case STATE.PENDING:\r\n            case STATE.DISAPPEAR_RESTART:\r\n                return\r\n            case STATE.DISAPPEAR:\r\n                this._state = STATE.DISAPPEAR_RESTART\r\n                return\r\n        }\r\n        this._state = STATE.APPEAR\r\n\r\n        const opts = this._opts\r\n        const transition = `width ${opts.duration}ms ${opts.timing}`\r\n        this._css({\r\n            width: '0',\r\n            opacity: '1',\r\n            transition,\r\n            webkitTransition: transition,\r\n        })\r\n        opts.container.appendChild(this._el)\r\n\r\n        this._rafId = requestAnimationFrame(() => {\r\n            this._rafId = requestAnimationFrame(() => {\r\n                this._rafId = null\r\n                this._state = STATE.PENDING\r\n                this._css({ width: this._opts.maxWidth })\r\n            })\r\n        })\r\n    }\r\n\r\n    end(immediately = false) {\r\n        this._promises = []\r\n        this._delayTimers.splice(0).forEach(clearTimeout)\r\n\r\n        switch (this._state) {\r\n            case STATE.NOTHING:\r\n                return\r\n            case STATE.APPEAR:\r\n                this._state = STATE.NOTHING\r\n                cancelAnimationFrame(this._rafId!)\r\n                this._rafId = null\r\n                detach(this._el)\r\n                return\r\n            case STATE.DISAPPEAR:\r\n            case STATE.DISAPPEAR_RESTART:\r\n                if (immediately) {\r\n                    this._state = STATE.NOTHING\r\n                    clearTimeout(this._timerId!)\r\n                    this._timerId = null\r\n                    detach(this._el)\r\n                } else {\r\n                    this._state = STATE.DISAPPEAR\r\n                }\r\n                return\r\n        }\r\n\r\n        if (immediately) {\r\n            this._state = STATE.NOTHING\r\n            detach(this._el)\r\n            return\r\n        }\r\n        this._state = STATE.DISAPPEAR\r\n\r\n        const opts = this._opts\r\n        const transition = `width 50ms, opacity ${opts.hideDuration}ms ${PERSIST_TIME}ms`\r\n        this._css({\r\n            width: '100%',\r\n            opacity: '0',\r\n            transition,\r\n            webkitTransition: transition,\r\n        })\r\n\r\n        this._timerId = setTimeout(() => {\r\n            this._timerId = null\r\n            const restart = this._state === STATE.DISAPPEAR_RESTART\r\n            this._state = STATE.NOTHING\r\n\r\n            detach(this._el)\r\n            if (restart) {\r\n                this.start()\r\n            }\r\n        }, opts.hideDuration + PERSIST_TIME)\r\n    }\r\n\r\n    promise<T>(p: Promise<T>, { delay = 0, min = 100 } = {}) {\r\n        let timerId: ReturnType<typeof setTimeout> | null\r\n\r\n        const start = () => {\r\n            if (min > 0) {\r\n                p = Promise.all([p, new Promise(res => setTimeout(res, min))]).then(([v]) => v)\r\n            }\r\n            this._promises.push(p)\r\n            this.start()\r\n        }\r\n        const cleanupTimer = () => {\r\n            const timers = this._delayTimers\r\n            timers.splice(timers.indexOf(timerId!) >>> 0, 1)\r\n            timerId = null\r\n        }\r\n        if (delay > 0) {\r\n            this._delayTimers.push(\r\n                (timerId = setTimeout(() => {\r\n                    cleanupTimer()\r\n                    start()\r\n                }, delay))\r\n            )\r\n        } else {\r\n            start()\r\n        }\r\n\r\n        const onFinally = () => {\r\n            if (timerId) {\r\n                clearTimeout(timerId)\r\n                cleanupTimer()\r\n                return\r\n            }\r\n            const promises = this._promises\r\n            const idx = promises.indexOf(p)\r\n            if (~idx) {\r\n                promises.splice(idx, 1)\r\n                if (promises.length === 0) this.end()\r\n            }\r\n        }\r\n        return p.then(\r\n            val => (onFinally(), val),\r\n            err => (onFinally(), Promise.reject(err))\r\n        )\r\n    }\r\n}\r\n\r\nfunction isNumber(v: any): v is number {\r\n    return typeof v === 'number'\r\n}\r\n\r\nfunction assign<T1, T2>(target: T1, src: T2): T1 & T2 {\r\n    for (const k in src) {\r\n        if (Object.prototype.hasOwnProperty.call(src, k)) (target as any)[k] = src[k]\r\n    }\r\n    return target as T1 & T2\r\n}\r\n\r\nfunction detach(el: HTMLElement) {\r\n    if (el.parentNode) el.parentNode.removeChild(el)\r\n}\r\n","import Progress from '../src'\r\n;(window as any).progress = new Progress({ height: 5 })\r\n;(window as any).delay = (ms: number) => new Promise(res => setTimeout(res, ms))\r\n"]}