{"mappings":"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","sources":["<anon>","app.ts","../src/index.ts"],"sourcesContent":["const $c3f0c132b8695422$var$STATE = {\n    DISAPPEAR: 0,\n    NOTHING: 1,\n    APPEAR: 2,\n    PENDING: 3,\n    DISAPPEAR_RESTART: 4\n};\nconst $c3f0c132b8695422$var$PERSIST_TIME = 150;\nclass $c3f0c132b8695422$export$b25a304ec7d746bb {\n    constructor(options = {}){\n        this._el = document.createElement(\"div\");\n        this._state = $c3f0c132b8695422$var$STATE.NOTHING;\n        this._opts = {\n            maxWidth: \"99.8%\",\n            height: \"4px\",\n            duration: 60000,\n            hideDuration: 400,\n            zIndex: \"9999\",\n            color: \"#ff1a59\",\n            className: \"\",\n            timing: \"cubic-bezier(0,1,0,1)\",\n            position: \"top\",\n            container: document.body\n        };\n        this._rafId = null;\n        this._timerId = null;\n        this._promises = [];\n        this._delayTimers = [];\n        this._detachListeners = [];\n        this.setOptions(options);\n    }\n    setOptions(newOptions) {\n        const opts = $c3f0c132b8695422$var$assign(this._opts, newOptions);\n        if (!isNaN(opts.maxWidth)) opts.maxWidth += \"px\";\n        if (!isNaN(opts.height)) opts.height += \"px\";\n        opts.zIndex = String(opts.zIndex);\n        this._el.className = opts.className;\n        this._css($c3f0c132b8695422$var$assign({\n            height: opts.height,\n            background: opts.color,\n            zIndex: opts.zIndex,\n            position: \"\",\n            left: \"\",\n            top: \"\",\n            bottom: \"\"\n        }, {\n            top: {\n                position: \"fixed\",\n                top: \"0\",\n                left: \"0\"\n            },\n            bottom: {\n                position: \"fixed\",\n                bottom: \"0\",\n                left: \"0\"\n            }\n        }[opts.position]));\n    }\n    _css(style) {\n        $c3f0c132b8695422$var$assign(this._el.style, style);\n    }\n    get isInProgress() {\n        return this._state !== 0;\n    }\n    start() {\n        switch(this._state){\n            case $c3f0c132b8695422$var$STATE.APPEAR:\n            case $c3f0c132b8695422$var$STATE.PENDING:\n            case $c3f0c132b8695422$var$STATE.DISAPPEAR_RESTART:\n                return;\n            case $c3f0c132b8695422$var$STATE.DISAPPEAR:\n                this._state = $c3f0c132b8695422$var$STATE.DISAPPEAR_RESTART;\n                return;\n        }\n        this._state = $c3f0c132b8695422$var$STATE.APPEAR;\n        const opts = this._opts;\n        const transition = `width ${opts.duration}ms ${opts.timing}`;\n        this._css({\n            width: \"0\",\n            opacity: \"1\",\n            transition: transition,\n            webkitTransition: transition\n        });\n        opts.container.appendChild(this._el);\n        this._rafId = requestAnimationFrame(()=>{\n            this._rafId = requestAnimationFrame(()=>{\n                this._rafId = null;\n                this._state = $c3f0c132b8695422$var$STATE.PENDING;\n                this._css({\n                    width: this._opts.maxWidth\n                });\n            });\n        });\n    }\n    end(immediately = false) {\n        this._promises = [];\n        this._delayTimers.splice(0).forEach(clearTimeout);\n        switch(this._state){\n            case $c3f0c132b8695422$var$STATE.NOTHING:\n                return;\n            case $c3f0c132b8695422$var$STATE.APPEAR:\n                this._state = $c3f0c132b8695422$var$STATE.NOTHING;\n                cancelAnimationFrame(this._rafId);\n                this._rafId = null;\n                this._detach();\n                return;\n            case $c3f0c132b8695422$var$STATE.DISAPPEAR:\n            case $c3f0c132b8695422$var$STATE.DISAPPEAR_RESTART:\n                if (immediately) {\n                    this._state = $c3f0c132b8695422$var$STATE.NOTHING;\n                    clearTimeout(this._timerId);\n                    this._timerId = null;\n                    this._detach();\n                } else this._state = $c3f0c132b8695422$var$STATE.DISAPPEAR;\n                return;\n        }\n        if (immediately) {\n            this._state = $c3f0c132b8695422$var$STATE.NOTHING;\n            this._detach();\n            return;\n        }\n        this._state = $c3f0c132b8695422$var$STATE.DISAPPEAR;\n        const opts = this._opts;\n        const transition = `width 50ms, opacity ${opts.hideDuration}ms ${$c3f0c132b8695422$var$PERSIST_TIME}ms`;\n        this._css({\n            width: \"100%\",\n            opacity: \"0\",\n            transition: transition,\n            webkitTransition: transition\n        });\n        this._timerId = setTimeout(()=>{\n            this._timerId = null;\n            const restart = this._state === $c3f0c132b8695422$var$STATE.DISAPPEAR_RESTART;\n            this._state = $c3f0c132b8695422$var$STATE.NOTHING;\n            this._detach();\n            if (restart) this.start();\n        }, opts.hideDuration + $c3f0c132b8695422$var$PERSIST_TIME);\n    }\n    _detach() {\n        this._detachListeners.splice(0).forEach((fn)=>fn());\n        this._el.parentNode?.removeChild(this._el);\n    }\n    promise(p, { delay: delay = 0, min: min = 100, waitAnimation: waitAnimation = false } = {}) {\n        let delayTid;\n        const start = ()=>{\n            if (min > 0) p = Promise.all([\n                p,\n                new Promise((res)=>setTimeout(res, min))\n            ]).then(([v])=>v);\n            this._promises.push(p);\n            this.start();\n        };\n        const cleanupDelayTimer = ()=>{\n            const timers = this._delayTimers;\n            timers.splice(timers.indexOf(delayTid) >>> 0, 1);\n            delayTid = null;\n        };\n        if (delay > 0) this._delayTimers.push(delayTid = setTimeout(()=>(cleanupDelayTimer(), start()), delay));\n        else start();\n        const next = (val)=>{\n            if (delayTid) {\n                clearTimeout(delayTid);\n                cleanupDelayTimer();\n                return val;\n            }\n            const ret = waitAnimation && this._state !== $c3f0c132b8695422$var$STATE.NOTHING ? new Promise((r)=>this._detachListeners.push(r)).then(()=>val) : val;\n            const promises = this._promises;\n            const idx = promises.indexOf(p);\n            if (~idx) {\n                promises.splice(idx, 1);\n                if (promises.length === 0) this.end();\n            }\n            return ret;\n        };\n        return p.then(next, (err)=>next(Promise.reject(err)));\n    }\n}\nfunction $c3f0c132b8695422$var$assign(target, src) {\n    for(const k in src)if (Object.prototype.hasOwnProperty.call(src, k)) target[k] = src[k];\n    return target;\n}\n\n\nwindow.progress = new (0, $c3f0c132b8695422$export$b25a304ec7d746bb)({\n    height: 5\n});\nwindow.delay = (ms)=>new Promise((res)=>setTimeout(res, ms));\n\n\n//# sourceMappingURL=index.e3b655d1.js.map\n","import { Progress } from 'rsup-progress'\n;(window as any).progress = new Progress({ height: 5 })\n;(window as any).delay = (ms: number) => new Promise(res => setTimeout(res, ms))\n","export interface ProgressOptions {\n    maxWidth?: number | string\n    height?: number | string\n    duration?: number\n    hideDuration?: number\n    zIndex?: number | string\n    className?: string\n    color?: string\n    timing?: string\n    position?: 'top' | 'bottom' | 'none'\n    container?: HTMLElement\n}\n\nconst STATE = {\n    DISAPPEAR: 0,\n    NOTHING: 1,\n    APPEAR: 2,\n    PENDING: 3,\n    DISAPPEAR_RESTART: 4,\n} as const\n\nconst PERSIST_TIME = 150\n\nexport class Progress {\n    private _el = document.createElement('div')\n    private _state = STATE.NOTHING as (typeof STATE)[keyof typeof STATE]\n    private _opts = {\n        maxWidth: '99.8%',\n        height: '4px',\n        duration: 60_000,\n        hideDuration: 400,\n        zIndex: '9999',\n        color: '#ff1a59',\n        className: '',\n        timing: 'cubic-bezier(0,1,0,1)',\n        position: 'top',\n        container: document.body,\n    }\n    private _rafId: number | null = null\n    private _timerId: ReturnType<typeof setTimeout> | null = null\n    private _promises: Promise<any>[] = []\n    private _delayTimers: ReturnType<typeof setTimeout>[] = []\n    private _detachListeners: (() => void)[] = []\n\n    constructor(options: ProgressOptions = {}) {\n        this.setOptions(options)\n    }\n\n    setOptions(newOptions: ProgressOptions) {\n        const opts = assign(this._opts, newOptions)\n\n        if (!isNaN(opts.maxWidth as any)) (opts.maxWidth as any) += 'px'\n        if (!isNaN(opts.height as any)) (opts.height as any) += 'px'\n        opts.zIndex = String(opts.zIndex)\n\n        this._el.className = opts.className\n        this._css(\n            assign(\n                {\n                    height: opts.height,\n                    background: opts.color,\n                    zIndex: opts.zIndex,\n                    position: '',\n                    left: '',\n                    top: '',\n                    bottom: '',\n                },\n                {\n                    top: {\n                        position: 'fixed',\n                        top: '0',\n                        left: '0',\n                    },\n                    bottom: {\n                        position: 'fixed',\n                        bottom: '0',\n                        left: '0',\n                    },\n                }[opts.position],\n            ),\n        )\n    }\n\n    private _css(style: Partial<CSSStyleDeclaration>) {\n        assign(this._el.style, style)\n    }\n\n    get isInProgress() {\n        return this._state !== 0\n    }\n\n    start() {\n        switch (this._state) {\n            case STATE.APPEAR:\n            case STATE.PENDING:\n            case STATE.DISAPPEAR_RESTART:\n                return\n            case STATE.DISAPPEAR:\n                this._state = STATE.DISAPPEAR_RESTART\n                return\n        }\n        this._state = STATE.APPEAR\n\n        const opts = this._opts\n        const transition = `width ${opts.duration}ms ${opts.timing}`\n        this._css({\n            width: '0',\n            opacity: '1',\n            transition,\n            webkitTransition: transition,\n        })\n        opts.container.appendChild(this._el)\n\n        this._rafId = requestAnimationFrame(() => {\n            this._rafId = requestAnimationFrame(() => {\n                this._rafId = null\n                this._state = STATE.PENDING\n                this._css({ width: this._opts.maxWidth })\n            })\n        })\n    }\n\n    end(immediately = false) {\n        this._promises = []\n        this._delayTimers.splice(0).forEach(clearTimeout)\n\n        switch (this._state) {\n            case STATE.NOTHING:\n                return\n            case STATE.APPEAR:\n                this._state = STATE.NOTHING\n                cancelAnimationFrame(this._rafId!)\n                this._rafId = null\n                this._detach()\n                return\n            case STATE.DISAPPEAR:\n            case STATE.DISAPPEAR_RESTART:\n                if (immediately) {\n                    this._state = STATE.NOTHING\n                    clearTimeout(this._timerId!)\n                    this._timerId = null\n                    this._detach()\n                } else {\n                    this._state = STATE.DISAPPEAR\n                }\n                return\n        }\n\n        if (immediately) {\n            this._state = STATE.NOTHING\n            this._detach()\n            return\n        }\n        this._state = STATE.DISAPPEAR\n\n        const opts = this._opts\n        const transition = `width 50ms, opacity ${opts.hideDuration}ms ${PERSIST_TIME}ms`\n        this._css({\n            width: '100%',\n            opacity: '0',\n            transition,\n            webkitTransition: transition,\n        })\n\n        this._timerId = setTimeout(() => {\n            this._timerId = null\n            const restart = this._state === STATE.DISAPPEAR_RESTART\n            this._state = STATE.NOTHING\n\n            this._detach()\n            if (restart) {\n                this.start()\n            }\n        }, opts.hideDuration + PERSIST_TIME)\n    }\n\n    private _detach() {\n        this._detachListeners.splice(0).forEach(fn => fn())\n        this._el.parentNode?.removeChild(this._el)\n    }\n\n    promise<T>(p: Promise<T>, { delay = 0, min = 100, waitAnimation = false } = {}) {\n        let delayTid: ReturnType<typeof setTimeout> | null\n\n        const start = () => {\n            if (min > 0) {\n                p = Promise.all([p, new Promise(res => setTimeout(res, min))]).then(([v]) => v)\n            }\n            this._promises.push(p)\n            this.start()\n        }\n\n        const cleanupDelayTimer = () => {\n            const timers = this._delayTimers\n            timers.splice(timers.indexOf(delayTid!) >>> 0, 1)\n            delayTid = null\n        }\n\n        if (delay > 0) {\n            this._delayTimers.push((delayTid = setTimeout(() => (cleanupDelayTimer(), start()), delay)))\n        } else {\n            start()\n        }\n\n        const next = (val: T | Promise<T>) => {\n            if (delayTid) {\n                clearTimeout(delayTid)\n                cleanupDelayTimer()\n                return val\n            }\n\n            const ret =\n                waitAnimation && this._state !== STATE.NOTHING\n                    ? new Promise<void>(r => this._detachListeners.push(r)).then(() => val)\n                    : val\n\n            const promises = this._promises\n            const idx = promises.indexOf(p)\n            if (~idx) {\n                promises.splice(idx, 1)\n                if (promises.length === 0) this.end()\n            }\n\n            return ret\n        }\n\n        return p.then(next, err => next(Promise.reject(err)))\n    }\n}\n\nfunction assign<T1, T2>(target: T1, src: T2): T1 & T2 {\n    for (const k in src) {\n        if (Object.prototype.hasOwnProperty.call(src, k)) (target as any)[k] = src[k]\n    }\n    return target as T1 & T2\n}\n"],"names":["$c3f0c132b8695422$var$STATE","DISAPPEAR","NOTHING","APPEAR","PENDING","DISAPPEAR_RESTART","$c3f0c132b8695422$var$assign","target","src","k","Object","prototype","hasOwnProperty","call","window","progress","constructor","options","_el","document","createElement","_state","_opts","maxWidth","height","duration","hideDuration","zIndex","color","className","timing","position","container","body","_rafId","_timerId","_promises","_delayTimers","_detachListeners","setOptions","newOptions","opts","isNaN","String","_css","background","left","top","bottom","style","isInProgress","start","transition","width","opacity","webkitTransition","appendChild","requestAnimationFrame","end","immediately","splice","forEach","clearTimeout","cancelAnimationFrame","_detach","setTimeout","restart","fn","parentNode","removeChild","promise","p","delay","min","waitAnimation","delayTid","Promise","all","res","then","v","push","cleanupDelayTimer","timers","indexOf","next","val","ret","r","promises","idx","length","err","reject","ms"],"version":3,"file":"index.e3b655d1.js.map"}